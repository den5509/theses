Д.В. Горелик – студент кафедры вычислительных систем и сетей

А.В. Гордеев (проф., докт.техн.наук) – научный руководитель
			
## ИСПОЛЬЗОВАНИЕ КОНТЕЙНЕРОВ ДЛЯ ПОСТРОЕНИЯ СИСТЕМЫ РАБОТЫ С УДАЛЕННЫМИ ВИРТУАЛЬНЫМИ МАШИНАМИ.


В процессе работы над созданием интерактивного учебного модуля по дисциплине «Корпоративные сети со службой каталога» возник ряд задач по организации эффективной и надежной работы одновременно нескольких пользователей со своими виртуальными машинами.

Виртуализация – это технология запуска одной операционной системы поверх другой[2]. В 2001 году компания VMware выпустила серверный продукт для виртуализации на основе гипервизора, привлекший внимание корпоративных заказчиков. Практически в то же самое время компания Parallels представила решение для контейнерной виртуализации Virtuozzo, завоевавшее признание у пользователей.

Гипервизор работает таким образом: операционная система хоста эмулирует аппаратное обеспечение, поверх которого уже запускаются гостевые операционные системы. Это означает, что взаимосвязь между гостевой и хостовой операционными системами следует правилу: все, что делает аппаратная часть, должно быть доступно гостевой операционной системе со стороны хостовой[2].

Контейнеры, напротив – это виртуализация на уровне операционной системы – то есть каждая гостевая операционная система использует то же самое ядро, что и хостовая. Это дает контейнерам большое преимущество: они меньше и компактнее гипервизорных гостевых сред, поскольку у них с хостом на много больше общего. 

Главным отличием между гипервизорной и контейнерной виртуализациями является среда, в которой работает система. Если запуск осуществляется в виде контейнера, то приложение попадает в ту же операционную среду, в которой работают и остальные приложения, с которыми происходит взаимодействие. Если запуск осуществляется в виде виртуальной машины на сервере, то любые запросы, совершенные в её сторону со стороны контактирующих приложений, проходят длинный путь из одной операционной среды в другую и обратно.

Переход на использование программных контейнеров и виртуальных машин призван решить главную задачу: выделить программный объект из базовой среды, чтобы вести его обработку в особых, оптимальных для него условиях. Но если контейнеры позволяют отделить объект от системной программной оболочки, работающей на сервере, то виртуальная машина служит для совершенно иных целей: она подменяет аппаратные возможности их виртуальными абстракциями, чтобы сделать процесс обработки независимым от реальных физических особенностей используемого оборудования.

Такое разделение продолжалось почти 12 лет: гипервизорной виртуализации не удавалось завоевать сколько-нибудь значимый кусок рынка, а контейнеры не могли проникнуть в корпоративный сегмент. Переломным стал 2013 год, когда новому разработчику Docker удалось привлечь внимание представителей бизнеса к преимуществам контейнерной технологии виртуализации[2].

Docker – это открытая платформа для разработки, доставки и эксплуатации приложений[1]. В своем ядре он позволяет запускать практически любое приложение, безопасно изолированное в контейнере. Безопасная изоляция позволяет запускать на одном хосте много контейнеров одновременно. Легковесная природа контейнера, который запускается без дополнительной нагрузки гипервизора, позволяет экономить аппаратные ресурсы.

В процессе изучения этих технологий виртуализации и программных продуктов, позволяющих их использовать были определены два пути, по которым можно работать с виртуальными машинами на сервере:
1) Использование непосредственно VirtualBox в операционной системе сервера. При использовании такого подхода возникает необходимость в решении вопросов: создания системы аутентификации и авторизации для пользователей, чтобы они не имели доступ к виртуальным машинам друг друга. А также необходима система, которая позволяла бы при нештатных ситуациях отключения одного из серверов, продолжить работу на другом без потери данных.
2) Использование Docker для обеспечения каждого пользователя контейнером. А уже после этого запускать Virtual-Box непосредственно в контейнере. В отличии от первого способа, это позволит сразу изолировать пользователей друг от друга, так как контейнеры являются полностью изолированными окружениями. А также при непредвиденной работе позволяет восстановить работу контейнера с момента, на котором произошел сбой, не потеряв при этом никаких данных.

Для определения - в каком направлении двигаться, необходимо провести небольшое исследование, которое на практике покажет достоинства и недостатки этих двух подходов и выявит оптимальный для создаваемой системы. Поэтому мною разработан следующий алгоритм исследования:
1) Так как в моем распоряжении имеется два абсолютно идентичных сервера, то на первом сервере была установлена программа Oracle Virtual-Box, а на втором - программное обеспечение Docker.
2) Для мониторинга нагрузки на аппаратную часть серверов был написан специальный скрипт, который с момента его запуска записывает в отдельный файл время, нагрузку на CPU в % и занятость оперативной памяти в %.
3) Для осуществления испытаний был избран следующий метод: так как к наиболее ресурсозатратным действием в Virtual-Box можно отнести установку операционной системы на виртуальную машину, поскольку при этом интенсивно загружаются и центральный процессор виртуальной машины, и его внешние устройства, то был создан специальный образ устанавливаемой операционной системы. В качестве устанавливаемой системы была выбрана Windows 7, и была подготовлена процедура автоматической установки без какого-либо дополнительного вмешательства пользователя.
4) На первом сервере была создана виртуальная машина, запущен скрипт документирования нагрузки, и затем запущена виртуальная машина, а в ней осуществлялась автоматизированная установка операционной системы. Полученные результаты были обработаны, и на основе полученных данных построен график зависимости нагрузки от времени – рисунок 1.
5) На втором сервере был запущен контейнер с аналогичной серверу операционной системой вместе с программой Virtual-Box. Далее в программе VirtualBox создана виртуальная машина, запущен скрипт документирования нагрузки в основной операционной системе, и затем запущена виртуальная машина в контейнере. И тоже была запущена установка операционной системы. Полученные результаты были обработаны, и на основе полученных данных построен второй график зависимости нагрузки от времени – рисунок 2.

Для более полной оценки было проведено исследование, которое заключается в увеличении количества виртуальных машин и контейнеров с VirtualBox. Алгоритм испытания аналогичен предыдущему, за исключением:

- Количество виртуальных машин на сервере увеличено до 3, они полностью аналогичны друг другу и на них одновременно проводится установка операционной системы Windows 7;
- Количество контейнеров увеличено до 3. В каждом из них одновременно запущена своя Virtual-Box с одной виртуальной машиной.
 
![alt]({{"/График 1.jpg" | absolute_url}}) Рисунок 1 – Нагрузка процессора и оперативной памяти на одном контейнере/виртуальной машине
 
![alt]({{"/График 2.jpg" | absolute_url}})Рисунок 2 – Нагрузка процессора и оперативной памяти на трех контейнерах/виртуальных машинах

Следует обратить внимание, что на обоих рисунках левая шкала отображает загрузку центрального процессора, а правая – использование оперативной памяти.

### По полученным графикам можно сделать следующие выводы:

- Виртуальные машины в стандартном гипервизорном окружении работают быстрее, но потребляют больше аппаратных ресурсов. У одной виртуальной машины на установку операционной системы уходит порядка 550 секунд, в то время как у контейнера с VirtualBox уходит приблизительно 700 секунд. 
- На всем протяжении работы, контейнер потребляет в общей сложности ресурсов меньше, чем виртуальная машина, но работает дольше.
- Если увеличить количество виртуальных машин до 3 раз, то количество потребляемых аппаратных ресурсов увеличивается в 2,5 раза. При этом время установки ОС на трех машинах одновременно удлинилось, но всего на 100 секунд, по сравнению с одной виртуальной машиной.
- При одновременной работе трех контейнеров с VirtualBox общее потребление ресурсов так же возросло по сравнению с работой одного контейнера, а вот время работы увеличилось существенно - на 560 секунд.

### По результатам проделанных исследования можно прийти к следующему выводу: 
Для построения системы работы с удаленными виртуальными машинами оптимальным решением можно считать использование виртуальных машин без контейнеров. Исследование показало, что потребление аппаратных ресурсов увеличивается практически одинаково с увеличением единиц виртуальных машин и контейнеров. Время выполнения действий так же растет, но с разной зависимостью. В случае виртуальных машин время растет на 1/5, а в случае контейнеров на 5/7. Для нашей системы этот критерий является очень важным. Он перечеркивает все основные плюсы контейнеров описанных выше. Для полного подтверждения этих выводов требуется провести еще одно испытание, в котором количество виртуальных машин и контейнеров будет увеличено до десяти. Это поможет вывести наиболее точную зависимость по потреблению ресурсов и по затрачиваемому времени на работу.

Библиографический список
- [Jessie Frazelle's: Docker Containers on the Desktop](https://blog.jessfraz.com/post/docker-containers-on-the-desktop/)
- Андрей Маркелов: OpenStack. Практическое знакомство с облачной операционной системой издание "ДМК-Пресс".

